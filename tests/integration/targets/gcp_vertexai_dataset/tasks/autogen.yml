# ----------------------------------------------------------------------------
#
#     ***     AUTO GENERATED CODE    ***    Type: MMv1     ***
#
# ----------------------------------------------------------------------------
#
#     This file is automatically generated by Magic Modules and manual
#     changes will be clobbered when the file is regenerated.
#
# ----------------------------------------------------------------------------
- name: Main test block
  block:
    - name: Create test network
      google.cloud.gcp_compute_network:
        name: "{{ resource_name }}"
        state: present
        auto_create_subnetworks: true
        project: "{{ gcp_project }}"
        auth_kind: "{{ gcp_cred_kind }}"
        service_account_file: "{{ gcp_cred_file }}"
      register: _network

    - name: Create dataset
      google.cloud.gcp_vertexai_dataset:
        state: present
        display_name: "{{ resource_name }}"
        metadata_schema_uri: "gs://google-cloud-aiplatform/schema/dataset/metadata/image_1.0.0.yaml"
        region: us-central1
        project: "{{ gcp_project }}"
        auth_kind: "{{ gcp_cred_kind }}"
        service_account_file: "{{ gcp_cred_file }}"
      register: _myds

    - name: Run assertions
      ansible.builtin.assert:
        that:
          - _myds.changed == true

    - name: Update dataset
      google.cloud.gcp_vertexai_dataset:
        state: present
        display_name: "{{ resource_name }}"
        metadata_schema_uri: "gs://google-cloud-aiplatform/schema/dataset/metadata/image_1.0.0.yaml"
        labels:
          env: test
        region: us-central1
        project: "{{ gcp_project }}"
        auth_kind: "{{ gcp_cred_kind }}"
        service_account_file: "{{ gcp_cred_file }}"
      register: _myds

    - name: Run assertions
      ansible.builtin.assert:
        that:
          - _myds.changed == true
          - _myds.labels | length > 0
          - _myds.labels.env == "test"

    - name: Destroy dataset
      google.cloud.gcp_vertexai_dataset:
        state: absent
        display_name: "{{ resource_name }}"
        metadata_schema_uri: "gs://google-cloud-aiplatform/schema/dataset/metadata/image_1.0.0.yaml"
        region: us-central1
        project: "{{ gcp_project }}"
        auth_kind: "{{ gcp_cred_kind }}"
        service_account_file: "{{ gcp_cred_file }}"

  always:
    - name: Destroy test network
      google.cloud.gcp_compute_network:
        name: "{{ resource_name }}"
        state: absent
        project: "{{ gcp_project }}"
        auth_kind: "{{ gcp_cred_kind }}"
        service_account_file: "{{ gcp_cred_file }}"
