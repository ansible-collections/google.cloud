# ----------------------------------------------------------------------------
#
#     ***     AUTO GENERATED CODE    ***    Type: MMv1     ***
#
# ----------------------------------------------------------------------------
#
#     This file is automatically generated by Magic Modules and manual
#     changes will be clobbered when the file is regenerated.
#
# ----------------------------------------------------------------------------
- name: Main test block
  block:
    - name: Create test network
      google.cloud.gcp_compute_network:
        name: "{{ resource_name }}"
        state: present
        auto_create_subnetworks: true
        project: "{{ gcp_project }}"
        auth_kind: "{{ gcp_cred_kind }}"
        service_account_file: "{{ gcp_cred_file }}"
      register: _network

    - name: Test case
      block:
        - name: Create key ring
          google.cloud.gcp_kms_key_ring:
            state: present
            name: key-key-ring
            location: us-central1
            project: "{{ gcp_project }}"
            auth_kind: "{{ gcp_cred_kind }}"
            service_account_file: "{{ gcp_cred_file }}"

        - name: Create crypto key
          google.cloud.gcp_kms_crypto_key:
            state: present
            name: reasoning-engine-key
            key_ring: "projects/{{ gcp_project }}/locations/us-central1/keyRings/key-key-ring"
            project: "{{ gcp_project }}"
            auth_kind: "{{ gcp_cred_kind }}"
            service_account_file: "{{ gcp_cred_file }}"
          register: _key

        - name: Create Basic Reasoning Engine
          google.cloud.gcp_vertexai_reasoning_engine:
            state: present
            display_name: "{{ resource_name }}"
            encryption_spec:
              kms_key_name: "projects/{{ gcp_project }}/locations/us-central1/keyRings/key-key-ring/cryptoKeys/reasoning-engine-key"
            region: us-central1
            project: "{{ gcp_project }}"
            auth_kind: "{{ gcp_cred_kind }}"
            service_account_file: "{{ gcp_cred_file }}"
          register: _rengine

        - name: Run assertions
          ansible.builtin.assert:
            that:
              - _rengine.changed == true

        - name: Update Reasoning Engine
          google.cloud.gcp_vertexai_reasoning_engine:
            state: present
            display_name: "{{ resource_name }}"
            description: "Updated description"
            encryption_spec:
              kms_key_name: "projects/{{ gcp_project }}/locations/us-central1/keyRings/key-key-ring/cryptoKeys/reasoning-engine-key"
            region: us-central1
            project: "{{ gcp_project }}"
            auth_kind: "{{ gcp_cred_kind }}"
            service_account_file: "{{ gcp_cred_file }}"
          register: _rengine

        - name: Run assertions
          ansible.builtin.assert:
            that:
              - _rengine.changed == true
              - _rengine.description == "Updated description"

      always:
        - name: Delete Reasoning Engine
          google.cloud.gcp_vertexai_reasoning_engine:
            state: absent
            display_name: "{{ resource_name }}"
            region: us-central1
            project: "{{ gcp_project }}"
            auth_kind: "{{ gcp_cred_kind }}"
            service_account_file: "{{ gcp_cred_file }}"

  always:
    - name: Destroy test network
      google.cloud.gcp_compute_network:
        name: "{{ resource_name }}"
        state: absent
        project: "{{ gcp_project }}"
        auth_kind: "{{ gcp_cred_kind }}"
        service_account_file: "{{ gcp_cred_file }}"
